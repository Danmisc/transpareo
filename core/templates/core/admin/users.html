{% extends 'core/admin/base_admin.html' %}
{% load static %}
{% load humanize %}

{% block title %}{{ page_title }}{% endblock %}

{% block page_title %}Gestion des Utilisateurs{% endblock %}

{% block content %}
<div class="admin-users-page">
    <!-- Header Section -->
    <div class="users-header">
        <div class="header-left">
            <h1 class="page-title-main">Gestion des Utilisateurs</h1>
            <p class="page-subtitle">{{ total_users|intcomma }} utilisateur{{ total_users|pluralize }}</p>
        </div>
        <div class="header-actions">
            <a href="?{% for key, value in request.GET.items %}{% if key != 'export' %}{{ key }}={{ value }}&{% endif %}{% endfor %}export=csv" class="btn-secondary">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Exporter CSV
            </a>
            <button class="btn-primary" onclick="openAddUserModal()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Ajouter Utilisateur
            </button>
        </div>
    </div>

    <!-- Statistiques -->
    <div class="stats-grid">
        <div class="stat-card stat-primary">
            <div class="stat-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ total_users|intcomma }}</div>
                <div class="stat-label">Total utilisateurs</div>
            </div>
        </div>
        
        <div class="stat-card stat-success">
            <div class="stat-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ active_users|intcomma }}</div>
                <div class="stat-label">Actifs</div>
            </div>
        </div>
        
        <div class="stat-card stat-info">
            <div class="stat-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ verified_users|intcomma }}</div>
                <div class="stat-label">V√©rifi√©s</div>
            </div>
        </div>
        
        <div class="stat-card stat-warning">
            <div class="stat-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ suspended_users|intcomma }}</div>
                <div class="stat-label">Suspendus</div>
            </div>
        </div>
        
        <div class="stat-card stat-danger">
            <div class="stat-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ banned_users|intcomma }}</div>
                <div class="stat-label">Bannis</div>
            </div>
        </div>
        
        <div class="stat-card stat-secondary">
            <div class="stat-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="8.5" cy="7" r="4"></circle>
                    <path d="M20 8v6M23 11h-6"></path>
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ new_users_week|intcomma }}</div>
                <div class="stat-label">Nouveaux (7j)</div>
            </div>
        </div>
        
        <div class="stat-card stat-secondary">
            <div class="stat-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ new_users_month|intcomma }}</div>
                <div class="stat-label">Nouveaux (30j)</div>
            </div>
        </div>
        
        <div class="stat-card stat-info">
            <div class="stat-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ recent_activity_users|intcomma }}</div>
                <div class="stat-label">Actifs (7j)</div>
            </div>
        </div>
        
        <div class="stat-card stat-primary">
            <div class="stat-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ proprietaires_count|intcomma }}</div>
                <div class="stat-label">Propri√©taires</div>
            </div>
        </div>
    </div>

    <!-- Filtres Avanc√©s -->
    <div class="filters-card">
        <form method="get" class="filters-form" id="users-filters-form">
            <div class="filters-row">
                <!-- Recherche -->
                <div class="filter-item filter-search">
                    <label for="search">Recherche</label>
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input type="text" name="search" id="search" value="{{ search_query }}" placeholder="Nom, email, ID..." class="search-input">
                    </div>
                </div>

                <!-- Type utilisateur -->
                <div class="filter-item">
                    <label for="user_type">Type</label>
                    <select name="user_type" id="user_type" class="filter-select">
                        <option value="all" {% if user_type_filter == 'all' %}selected{% endif %}>Tous</option>
                        <option value="locataires" {% if user_type_filter == 'locataires' %}selected{% endif %}>Locataires</option>
                        <option value="proprietaires" {% if user_type_filter == 'proprietaires' %}selected{% endif %}>Propri√©taires</option>
                        <option value="entreprises" {% if user_type_filter == 'entreprises' %}selected{% endif %}>Entreprises</option>
                    </select>
                </div>

                <!-- Statut (multi-select) -->
                <div class="filter-item">
                    <label for="status">Statut</label>
                    <div class="multi-select-wrapper">
                        <select name="status" id="status" class="filter-select multi-select" multiple>
                            <option value="actif" {% if 'actif' in status_filters %}selected{% endif %}>Actif</option>
                            <option value="suspendu" {% if 'suspendu' in status_filters %}selected{% endif %}>Suspendu</option>
                            <option value="banni" {% if 'banni' in status_filters %}selected{% endif %}>Banni</option>
                            <option value="pending" {% if 'pending' in status_filters %}selected{% endif %}>En attente v√©rification</option>
                        </select>
                    </div>
                </div>

                <!-- Date inscription -->
                <div class="filter-item filter-date-range">
                    <label>Date inscription</label>
                    <div class="date-range">
                        <input type="date" name="date_from" value="{{ date_from }}" class="date-input" placeholder="Du">
                        <span class="date-separator">‚Üí</span>
                        <input type="date" name="date_to" value="{{ date_to }}" class="date-input" placeholder="Au">
                    </div>
                </div>
            </div>

            <div class="filters-row">
                <!-- Ville (multi-select) -->
                <div class="filter-item">
                    <label for="city">Ville</label>
                    <div class="multi-select-wrapper">
                        <select name="city" id="city" class="filter-select multi-select" multiple>
                            {% for city in available_cities %}
                            <option value="{{ city }}" {% if city in cities_filter %}selected{% endif %}>{{ city }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Badges -->
                <div class="filter-item filter-badges">
                    <label>Badges</label>
                    <div class="badges-checkboxes">
                        <label class="checkbox-label">
                            <input type="checkbox" name="badge" value="email_verified" {% if 'email_verified' in badges_filter %}checked{% endif %}>
                            <span>Email v√©rifi√©</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="badge" value="identity_verified" {% if 'identity_verified' in badges_filter %}checked{% endif %}>
                            <span>Identit√© v√©rifi√©e</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="badge" value="owner_verified" {% if 'owner_verified' in badges_filter %}checked{% endif %}>
                            <span>Propri√©taire v√©rifi√©</span>
                        </label>
                    </div>
                </div>

                <!-- Pagination per page -->
                <div class="filter-item">
                    <label for="per_page">Par page</label>
                    <select name="per_page" id="per_page" class="filter-select">
                        <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
                        <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                        <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                    </select>
                </div>

                <div class="filter-actions">
                    <button type="submit" class="btn-filter">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                        </svg>
                        Filtrer
                    </button>
                    <a href="{% url 'admin-users' %}" class="btn-filter-reset">
                        R√©initialiser
                    </a>
                </div>
            </div>
        </form>
    </div>

    <!-- Actions Bulk (affich√© si s√©lection) -->
    <div class="bulk-actions-bar" id="bulk-actions-bar" style="display: none;">
        <div class="bulk-info">
            <span id="bulk-count">0</span> utilisateur{{ 's'|pluralize }} s√©lectionn√©{{ 's'|pluralize }}
        </div>
        <div class="bulk-buttons">
            <button class="btn-bulk" onclick="bulkAction('suspend')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                Suspendre
            </button>
            <button class="btn-bulk" onclick="bulkAction('email')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                    <polyline points="22 6 12 13 2 6"></polyline>
                </svg>
                Envoyer email
            </button>
            <button class="btn-bulk" onclick="bulkAction('export')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Exporter s√©lection
            </button>
            <button class="btn-bulk-secondary" onclick="clearSelection()">
                D√©s√©lectionner tout
            </button>
        </div>
    </div>

    <!-- Tableau Utilisateurs -->
    <div class="table-card">
        <table class="users-table" id="users-table">
            <thead>
                <tr>
                    <th class="col-checkbox">
                        <input type="checkbox" id="select-all" class="checkbox-input" onchange="toggleSelectAll(this)">
                    </th>
                    <th class="col-avatar">Avatar</th>
                    <th class="col-name sortable" data-sort="username">
                        Nom/Pr√©nom
                        <svg class="sort-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </th>
                    <th class="col-email sortable" data-sort="email">
                        Email
                        <svg class="sort-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </th>
                    <th class="col-type">Type</th>
                    <th class="col-status">Statut</th>
                    <th class="col-city">Ville</th>
                    <th class="col-date sortable" data-sort="date_joined">
                        Date inscription
                        <svg class="sort-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </th>
                    <th class="col-activity">Activit√©</th>
                    <th class="col-badges">Badges</th>
                    <th class="col-actions">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr class="table-row" data-user-id="{{ user.id }}">
                    <td class="col-checkbox">
                        <input type="checkbox" class="checkbox-input user-checkbox" value="{{ user.id }}" onchange="updateBulkActions()">
                    </td>
                    <td class="col-avatar">
                        {% if user.avatar %}
                        <img src="{{ user.avatar.url }}" alt="{{ user.username }}" class="user-avatar">
                        {% else %}
                        <div class="user-avatar-placeholder">{{ user.username|first|upper }}</div>
                        {% endif %}
                    </td>
                    <td class="col-name">
                        <a href="{% url 'admin-user-detail' user.id %}" class="user-name-link">
                            <strong>{{ user.get_full_name|default:user.username }}</strong>
                        </a>
                        <div class="user-username">@{{ user.username }}</div>
                    </td>
                    <td class="col-email">
                        <span class="email-text" onclick="copyEmail('{{ user.email }}')" title="Cliquer pour copier">{{ user.email }}</span>
                        <svg class="copy-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </td>
                    <td class="col-type">
                        {% if user.is_locataire %}
                        <span class="type-badge type-tenant">üìç Locataire</span>
                        {% endif %}
                        {% if user.is_proprietaire %}
                        <span class="type-badge type-owner">üè† Propri√©taire</span>
                        {% endif %}
                        {% if user.is_proprietaire and not user.is_locataire %}
                        <span class="type-badge type-company">üè¢ Entreprise</span>
                        {% endif %}
                    </td>
                    <td class="col-status">
                        {% if user.is_banned %}
                        <span class="status-badge status-banned">Banni</span>
                        {% elif user.is_suspended %}
                        <span class="status-badge status-suspended">Suspendu</span>
                        {% else %}
                        <span class="status-badge status-active">Actif</span>
                        {% endif %}
                    </td>
                    <td class="col-city">{{ user.ville|default:"‚Äî" }}</td>
                    <td class="col-date">{{ user.date_joined|date:"d/m/Y" }}</td>
                    <td class="col-activity">
                        <div class="activity-stats">
                            <span class="activity-item" title="Posts">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                {{ user.posts_count|default:0 }}
                            </span>
                            <span class="activity-item" title="Groupes">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                {{ user.groups_count|default:0 }}
                            </span>
                            <span class="activity-item" title="Connexions">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                                </svg>
                                {{ user.connections_count|default:0 }}
                            </span>
                        </div>
                    </td>
                    <td class="col-badges">
                        <div class="badges-list">
                            {% if user.email_verified %}
                            <span class="badge-icon" title="Email v√©rifi√©">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </span>
                            {% endif %}
                            {% if user.identity_verified %}
                            <span class="badge-icon" title="Identit√© v√©rifi√©e">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                            </span>
                            {% endif %}
                            {% if user.proprietaire_verified %}
                            <span class="badge-icon" title="Propri√©taire v√©rifi√©">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                </svg>
                            </span>
                            {% endif %}
                        </div>
                    </td>
                    <td class="col-actions">
                        <div class="actions-dropdown">
                            <button class="actions-btn" onclick="toggleActionsDropdown(this)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="1"></circle>
                                    <circle cx="12" cy="5" r="1"></circle>
                                    <circle cx="12" cy="19" r="1"></circle>
                                </svg>
                            </button>
                            <div class="dropdown-menu">
                                <a href="{% url 'admin-user-detail' user.id %}" class="dropdown-item">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    Voir profil d√©tail
                                </a>
                                <a href="#" class="dropdown-item" onclick="editUser({{ user.id }}); return false;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                    Modifier
                                </a>
                                <div class="dropdown-divider"></div>
                                {% if not user.is_suspended and not user.is_banned %}
                                <a href="#" class="dropdown-item dropdown-warning" onclick="suspendUser({{ user.id }}); return false;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="12" y1="8" x2="12" y2="12"></line>
                                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                    </svg>
                                    Suspendre
                                </a>
                                {% elif user.is_suspended %}
                                <a href="#" class="dropdown-item dropdown-success" onclick="reactivateUser({{ user.id }}); return false;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                    R√©activer
                                </a>
                                {% endif %}
                                {% if not user.is_banned %}
                                <a href="#" class="dropdown-item dropdown-danger" onclick="banUser({{ user.id }}); return false;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="15" y1="9" x2="9" y2="15"></line>
                                        <line x1="9" y1="9" x2="15" y2="15"></line>
                                    </svg>
                                    Bannir
                                </a>
                                {% endif %}
                                {% if user.email_verified or user.identity_verified or user.proprietaire_verified %}
                                <a href="#" class="dropdown-item dropdown-warning" onclick="revokeBadges({{ user.id }}); return false;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M18 6L6 18"></path>
                                        <path d="M6 6l12 12"></path>
                                    </svg>
                                    R√©voquer badges
                                </a>
                                {% endif %}
                                <div class="dropdown-divider"></div>
                                <a href="#" class="dropdown-item dropdown-danger" onclick="deleteUser({{ user.id }}); return false;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                    Supprimer
                                </a>
                            </div>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="12" class="empty-state">
                        <div class="empty-content">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                            <p>Aucun utilisateur trouv√©</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pagination -->
        {% if users.has_other_pages %}
        <div class="pagination-wrapper">
            <div class="pagination-info">
                Affichage de {{ users.start_index }} √† {{ users.end_index }} sur {{ total_users }} utilisateur{{ total_users|pluralize }}
            </div>
            <div class="pagination">
                {% if users.has_previous %}
                <a href="?page={{ users.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                    Pr√©c√©dent
                </a>
                {% endif %}

                {% for num in users.paginator.page_range %}
                    {% if users.number == num %}
                    <span class="page-current">{{ num }}</span>
                    {% elif num > users.number|add:'-3' and num < users.number|add:'3' %}
                    <a href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">{{ num }}</a>
                    {% endif %}
                {% endfor %}

                {% if users.has_next %}
                <a href="?page={{ users.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">
                    Suivant
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Modal Ajouter Utilisateur -->
<div class="modal-overlay" id="add-user-modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Ajouter un utilisateur</h2>
            <button class="modal-close" onclick="closeAddUserModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <p>Cette fonctionnalit√© sera disponible dans une prochaine version.</p>
        </div>
    </div>
</div>

<!-- Styles -->
<link rel="stylesheet" href="{% static 'core/admin/users.css' %}">

<!-- JavaScript -->
<script src="{% static 'core/admin/users.js' %}"></script>

<script>
    // Variables globales pour le tri
    const currentSort = '{{ sort_by|default:"-date_joined" }}';
    
    // Initialiser les fonctions
    document.addEventListener('DOMContentLoaded', function() {
        initUsersTable();
        initMultiSelect();
        initDateRange();
    });
</script>
{% endblock %}
