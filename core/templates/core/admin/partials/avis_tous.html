{% load humanize %}
<!-- Filtres Avanc√©s -->
<div class="filters-section">
    <div class="filters-header">
        <h3>Filtres avanc√©s</h3>
        <button class="btn-ghost btn-small" onclick="toggleFilters()">
            <span id="filters-toggle-text">Masquer</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </button>
    </div>
    <div class="filters-content" id="filters-content">
        <form method="GET" action="{% url 'admin-avis' %}" id="filters-form">
            <input type="hidden" name="view" value="tous">
            
            <!-- Row 1 -->
            <div class="filter-row">
                <div class="filter-field filter-search">
                    <label>Recherche globale</label>
                    <div class="search-input-wrapper">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input type="text" name="search" value="{{ filters.search }}" 
                               placeholder="Contenu avis, auteur, logement..." class="filter-input">
                    </div>
                </div>
                <div class="filter-field">
                    <label>Note</label>
                    <select name="note" multiple class="filter-select multi-select">
                        <option value="5" {% if '5' in filters.note %}selected{% endif %}>5 √©toiles</option>
                        <option value="4" {% if '4' in filters.note %}selected{% endif %}>4 √©toiles</option>
                        <option value="3" {% if '3' in filters.note %}selected{% endif %}>3 √©toiles</option>
                        <option value="2" {% if '2' in filters.note %}selected{% endif %}>2 √©toiles</option>
                        <option value="1" {% if '1' in filters.note %}selected{% endif %}>1 √©toile</option>
                    </select>
                </div>
                <div class="filter-field">
                    <label>Statut</label>
                    <select name="statut" class="filter-select">
                        <option value="">Tous</option>
                        <option value="verifie" {% if filters.statut == 'verifie' %}selected{% endif %}>V√©rifi√©</option>
                        <option value="non_verifie" {% if filters.statut == 'non_verifie' %}selected{% endif %}>Non v√©rifi√©</option>
                    </select>
                </div>
            </div>
            
            <!-- Row 2 -->
            <div class="filter-row">
                <div class="filter-field">
                    <label>Logement concern√©</label>
                    <input type="text" name="logement" value="{{ filters.logement }}" 
                           placeholder="Rechercher par adresse/ID..." class="filter-input autocomplete">
                </div>
                <div class="filter-field">
                    <label>Auteur avis</label>
                    <input type="text" name="auteur" value="{{ filters.auteur }}" 
                           placeholder="Nom ou email..." class="filter-input autocomplete">
                </div>
                <div class="filter-field">
                    <label>Date publication</label>
                    <div class="date-range">
                        <input type="date" name="date_debut" value="{{ filters.date_debut }}" class="filter-input">
                        <span>√†</span>
                        <input type="date" name="date_fin" value="{{ filters.date_fin }}" class="filter-input">
                    </div>
                </div>
            </div>
            
            <!-- Row 3 -->
            <div class="filter-row">
                <div class="filter-field">
                    <label>Ville logement</label>
                    <select name="ville" class="filter-select">
                        <option value="">Toutes</option>
                        {% for ville in available_villes %}
                        <option value="{{ ville }}" {% if filters.ville == ville %}selected{% endif %}>{{ ville }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="filter-actions">
                <button type="submit" class="btn-primary">Appliquer filtres</button>
                <button type="button" class="btn-secondary" onclick="resetFilters()">R√©initialiser</button>
                <button type="button" class="btn-ghost" onclick="saveSearch()">Sauvegarder cette recherche</button>
            </div>
        </form>
    </div>
</div>

<!-- Toggles tri rapide -->
<div class="quick-filters">
    <button class="quick-filter-pill {% if not filters.note and not filters.statut %}active{% endif %}" 
            onclick="filterByCategory('')">
        Tous <span class="pill-count">{{ count_by_category.tous }}</span>
    </button>
    <button class="quick-filter-pill" onclick="filterByCategory('recents')">
        R√©cents <span class="pill-count">{{ count_by_category.recents }}</span>
    </button>
    <button class="quick-filter-pill" onclick="filterByCategory('bien_notes')">
        Bien not√©s <span class="pill-count badge-green">{{ count_by_category.bien_notes }}</span>
    </button>
    <button class="quick-filter-pill" onclick="filterByCategory('mal_notes')">
        Mal not√©s <span class="pill-count badge-red">{{ count_by_category.mal_notes }}</span>
    </button>
</div>

<!-- Tableau Avis -->
<div class="table-section">
    <div class="table-header">
        <div class="table-header-left">
            <h3>Avis</h3>
            <button class="btn-ghost btn-small" onclick="openColumnsModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="9" y1="3" x2="9" y2="21"></line>
                </svg>
                Colonnes
            </button>
            <button class="btn-ghost btn-small" onclick="switchToCards()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Vue Cards
            </button>
        </div>
    </div>

    <!-- Actions bulk -->
    <div class="bulk-actions-bar" id="bulk-actions-bar" style="display: none;">
        <span class="bulk-count"><span id="bulk-count">0</span> avis s√©lectionn√©s</span>
        <div class="bulk-buttons">
            <button class="btn-secondary btn-small" onclick="bulkPublier()">Publier tous</button>
            <button class="btn-secondary btn-small" onclick="bulkMasquer()">Masquer tous</button>
            <button class="btn-secondary btn-small" onclick="bulkMarquerSpam()">Marquer spam</button>
            <button class="btn-secondary btn-small" onclick="bulkExport()">Exporter s√©lection</button>
            <button class="btn-ghost btn-small" onclick="clearSelection()">D√©s√©lectionner tout</button>
        </div>
    </div>

    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th class="col-checkbox sticky-left">
                        <input type="checkbox" id="select-all" onchange="toggleSelectAll(this)">
                    </th>
                    <th class="col-id">ID</th>
                    <th class="col-auteur sticky-left-after-checkbox">Auteur</th>
                    <th class="col-note">Note</th>
                    <th class="col-logement">Logement</th>
                    <th class="col-type">Type</th>
                    <th class="col-contenu">Contenu</th>
                    <th class="col-date sortable" onclick="sortTable('date_avis')">
                        Date publication
                        {% if sort_by == 'date_avis' or sort_by == '-date_avis' %}
                        <span class="sort-indicator {% if sort_by == '-date_avis' %}desc{% else %}asc{% endif %}"></span>
                        {% endif %}
                    </th>
                    <th class="col-statut">Statut</th>
                    <th class="col-reponse">R√©ponse</th>
                    <th class="col-utilite">Utilit√©</th>
                    <th class="col-actions sticky-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for avis in avis %}
                <tr class="table-row" data-avis-id="{{ avis.id }}">
                    <td class="col-checkbox sticky-left">
                        <input type="checkbox" class="avis-checkbox" value="{{ avis.id }}" 
                               onchange="updateBulkActions()">
                    </td>
                    <td class="col-id">
                        <span class="id-text" onclick="copyToClipboard('{{ avis.id }}')">{{ avis.id }}</span>
                    </td>
                    <td class="col-auteur sticky-left-after-checkbox">
                        <div class="auteur-cell">
                            <div class="avatar-small">
                                {% if avis.locataire.avatar %}
                                <img src="{{ avis.locataire.avatar.url }}" alt="{{ avis.locataire.username }}">
                                {% else %}
                                <div class="avatar-placeholder">{{ avis.locataire.username|first|upper }}</div>
                                {% endif %}
                            </div>
                            <div class="auteur-info">
                                <a href="/connect-admin/users/{{ avis.locataire.id }}/" class="auteur-name">
                                    <strong>{{ avis.locataire.username }}</strong>
                                </a>
                                {% if avis.locataire.email_verified %}
                                <span class="badge-verifie">‚úì V√©rifi√©</span>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td class="col-note">
                        <div class="note-display">
                            {% for i in "12345" %}
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="{% if forloop.counter <= avis.note %}currentColor{% else %}none{% endif %}" 
                                 stroke="currentColor" stroke-width="2" 
                                 class="note-star {% if forloop.counter <= avis.note %}{% if avis.note >= 4 %}note-vert{% elif avis.note >= 3 %}note-orange{% else %}note-rouge{% endif %}{% endif %}">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                            {% endfor %}
                            <span class="note-value">{{ avis.note }}/5</span>
                        </div>
                    </td>
                    <td class="col-logement">
                        <div class="logement-cell">
                            <div class="logement-thumbnail">üì∑</div>
                            <div class="logement-info">
                                <a href="/connect-admin/logements/{{ avis.logement.id }}/" class="logement-link">
                                    {{ avis.logement.titre|truncatewords:5 }}
                                </a>
                                <div class="logement-address">{{ avis.logement.adresse|truncatewords:3 }}</div>
                            </div>
                        </div>
                    </td>
                    <td class="col-type">
                        <span class="type-badge type-logement">Logement</span>
                    </td>
                    <td class="col-contenu">
                        <div class="contenu-apercu" title="{{ avis.commentaire }}">
                            {{ avis.commentaire|truncatewords:15 }}
                        </div>
                    </td>
                    <td class="col-date">{{ avis.date_avis|timesince }}</td>
                    <td class="col-statut">
                        {% if avis.verifie %}
                        <span class="statut-badge statut-verifie">Publi√©</span>
                        {% else %}
                        <span class="statut-badge statut-en_attente">En attente</span>
                        {% endif %}
                    </td>
                    <td class="col-reponse">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="gray" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </td>
                    <td class="col-utilite">
                        <div class="utilite-display">
                            <span class="thumbs-up">üëç 0</span>
                            <span class="thumbs-down">üëé 0</span>
                        </div>
                    </td>
                    <td class="col-actions sticky-right">
                        <div class="actions-dropdown">
                            <button class="actions-btn" onclick="toggleActionsDropdown(this)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="1"></circle>
                                    <circle cx="12" cy="5" r="1"></circle>
                                    <circle cx="12" cy="19" r="1"></circle>
                                </svg>
                            </button>
                            <div class="dropdown-menu">
                                <a href="#" class="dropdown-item" onclick="openAvisDetail({{ avis.id }})">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    Voir d√©tail complet
                                </a>
                                {% if not avis.verifie %}
                                <a href="#" class="dropdown-item" onclick="approuverAvis({{ avis.id }})">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="green" stroke-width="2">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                    Approuver/Publier
                                </a>
                                {% endif %}
                                <a href="#" class="dropdown-item" onclick="masquerAvis({{ avis.id }})">
                                    Masquer avis
                                </a>
                                <div class="dropdown-divider"></div>
                                <a href="#" class="dropdown-item dropdown-danger" onclick="supprimerAvis({{ avis.id }})">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                    Supprimer
                                </a>
                            </div>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="12" class="empty-state">
                        <p>Aucun avis trouv√©</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if avis.has_other_pages %}
    <div class="pagination-wrapper">
        <div class="pagination-info">
            <select class="per-page-select" onchange="changePerPage(this.value)">
                <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
                <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                <option value="250" {% if per_page == 250 %}selected{% endif %}>250</option>
            </select>
            <span class="pagination-text">
                Affichage {{ avis.start_index }}-{{ avis.end_index }} sur {{ avis.paginator.count|intcomma }} avis
            </span>
        </div>
        <div class="pagination-controls">
            {% if avis.has_previous %}
            <a href="?page={{ avis.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">Pr√©c√©dent</a>
            {% endif %}
            {% for num in avis.paginator.page_range %}
                {% if avis.number == num %}
                <span class="page-current">{{ num }}</span>
                {% elif num > avis.number|add:'-3' and num < avis.number|add:'3' %}
                <a href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">{{ num }}</a>
                {% endif %}
            {% endfor %}
            {% if avis.has_next %}
            <a href="?page={{ avis.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">Suivant</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Filtres Avanc√©s -->
<div class="filters-section">
    <div class="filters-header">
        <h3>Filtres avanc√©s</h3>
        <button class="btn-ghost btn-small" onclick="toggleFilters()">
            <span id="filters-toggle-text">Masquer</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </button>
    </div>
    <div class="filters-content" id="filters-content">
        <form method="GET" action="{% url 'admin-avis' %}" id="filters-form">
            <input type="hidden" name="view" value="tous">
            
            <!-- Row 1 -->
            <div class="filter-row">
                <div class="filter-field filter-search">
                    <label>Recherche globale</label>
                    <div class="search-input-wrapper">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input type="text" name="search" value="{{ filters.search }}" 
                               placeholder="Contenu avis, auteur, logement..." class="filter-input">
                    </div>
                </div>
                <div class="filter-field">
                    <label>Note</label>
                    <select name="note" multiple class="filter-select multi-select">
                        <option value="5" {% if '5' in filters.note %}selected{% endif %}>5 √©toiles</option>
                        <option value="4" {% if '4' in filters.note %}selected{% endif %}>4 √©toiles</option>
                        <option value="3" {% if '3' in filters.note %}selected{% endif %}>3 √©toiles</option>
                        <option value="2" {% if '2' in filters.note %}selected{% endif %}>2 √©toiles</option>
                        <option value="1" {% if '1' in filters.note %}selected{% endif %}>1 √©toile</option>
                    </select>
                </div>
                <div class="filter-field">
                    <label>Statut</label>
                    <select name="statut" class="filter-select">
                        <option value="">Tous</option>
                        <option value="verifie" {% if filters.statut == 'verifie' %}selected{% endif %}>V√©rifi√©</option>
                        <option value="non_verifie" {% if filters.statut == 'non_verifie' %}selected{% endif %}>Non v√©rifi√©</option>
                    </select>
                </div>
            </div>
            
            <!-- Row 2 -->
            <div class="filter-row">
                <div class="filter-field">
                    <label>Logement concern√©</label>
                    <input type="text" name="logement" value="{{ filters.logement }}" 
                           placeholder="Rechercher par adresse/ID..." class="filter-input autocomplete">
                </div>
                <div class="filter-field">
                    <label>Auteur avis</label>
                    <input type="text" name="auteur" value="{{ filters.auteur }}" 
                           placeholder="Nom ou email..." class="filter-input autocomplete">
                </div>
                <div class="filter-field">
                    <label>Date publication</label>
                    <div class="date-range">
                        <input type="date" name="date_debut" value="{{ filters.date_debut }}" class="filter-input">
                        <span>√†</span>
                        <input type="date" name="date_fin" value="{{ filters.date_fin }}" class="filter-input">
                    </div>
                </div>
            </div>
            
            <!-- Row 3 -->
            <div class="filter-row">
                <div class="filter-field">
                    <label>Ville logement</label>
                    <select name="ville" class="filter-select">
                        <option value="">Toutes</option>
                        {% for ville in available_villes %}
                        <option value="{{ ville }}" {% if filters.ville == ville %}selected{% endif %}>{{ ville }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="filter-actions">
                <button type="submit" class="btn-primary">Appliquer filtres</button>
                <button type="button" class="btn-secondary" onclick="resetFilters()">R√©initialiser</button>
                <button type="button" class="btn-ghost" onclick="saveSearch()">Sauvegarder cette recherche</button>
            </div>
        </form>
    </div>
</div>

<!-- Toggles tri rapide -->
<div class="quick-filters">
    <button class="quick-filter-pill {% if not filters.note and not filters.statut %}active{% endif %}" 
            onclick="filterByCategory('')">
        Tous <span class="pill-count">{{ count_by_category.tous }}</span>
    </button>
    <button class="quick-filter-pill" onclick="filterByCategory('recents')">
        R√©cents <span class="pill-count">{{ count_by_category.recents }}</span>
    </button>
    <button class="quick-filter-pill" onclick="filterByCategory('bien_notes')">
        Bien not√©s <span class="pill-count badge-green">{{ count_by_category.bien_notes }}</span>
    </button>
    <button class="quick-filter-pill" onclick="filterByCategory('mal_notes')">
        Mal not√©s <span class="pill-count badge-red">{{ count_by_category.mal_notes }}</span>
    </button>
</div>

<!-- Tableau Avis -->
<div class="table-section">
    <div class="table-header">
        <div class="table-header-left">
            <h3>Avis</h3>
            <button class="btn-ghost btn-small" onclick="openColumnsModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="9" y1="3" x2="9" y2="21"></line>
                </svg>
                Colonnes
            </button>
            <button class="btn-ghost btn-small" onclick="switchToCards()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Vue Cards
            </button>
        </div>
    </div>

    <!-- Actions bulk -->
    <div class="bulk-actions-bar" id="bulk-actions-bar" style="display: none;">
        <span class="bulk-count"><span id="bulk-count">0</span> avis s√©lectionn√©s</span>
        <div class="bulk-buttons">
            <button class="btn-secondary btn-small" onclick="bulkPublier()">Publier tous</button>
            <button class="btn-secondary btn-small" onclick="bulkMasquer()">Masquer tous</button>
            <button class="btn-secondary btn-small" onclick="bulkMarquerSpam()">Marquer spam</button>
            <button class="btn-secondary btn-small" onclick="bulkExport()">Exporter s√©lection</button>
            <button class="btn-ghost btn-small" onclick="clearSelection()">D√©s√©lectionner tout</button>
        </div>
    </div>

    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th class="col-checkbox sticky-left">
                        <input type="checkbox" id="select-all" onchange="toggleSelectAll(this)">
                    </th>
                    <th class="col-id">ID</th>
                    <th class="col-auteur sticky-left-after-checkbox">Auteur</th>
                    <th class="col-note">Note</th>
                    <th class="col-logement">Logement</th>
                    <th class="col-type">Type</th>
                    <th class="col-contenu">Contenu</th>
                    <th class="col-date sortable" onclick="sortTable('date_avis')">
                        Date publication
                        {% if sort_by == 'date_avis' or sort_by == '-date_avis' %}
                        <span class="sort-indicator {% if sort_by == '-date_avis' %}desc{% else %}asc{% endif %}"></span>
                        {% endif %}
                    </th>
                    <th class="col-statut">Statut</th>
                    <th class="col-reponse">R√©ponse</th>
                    <th class="col-utilite">Utilit√©</th>
                    <th class="col-actions sticky-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for avis in avis %}
                <tr class="table-row" data-avis-id="{{ avis.id }}">
                    <td class="col-checkbox sticky-left">
                        <input type="checkbox" class="avis-checkbox" value="{{ avis.id }}" 
                               onchange="updateBulkActions()">
                    </td>
                    <td class="col-id">
                        <span class="id-text" onclick="copyToClipboard('{{ avis.id }}')">{{ avis.id }}</span>
                    </td>
                    <td class="col-auteur sticky-left-after-checkbox">
                        <div class="auteur-cell">
                            <div class="avatar-small">
                                {% if avis.locataire.avatar %}
                                <img src="{{ avis.locataire.avatar.url }}" alt="{{ avis.locataire.username }}">
                                {% else %}
                                <div class="avatar-placeholder">{{ avis.locataire.username|first|upper }}</div>
                                {% endif %}
                            </div>
                            <div class="auteur-info">
                                <a href="/connect-admin/users/{{ avis.locataire.id }}/" class="auteur-name">
                                    <strong>{{ avis.locataire.username }}</strong>
                                </a>
                                {% if avis.locataire.email_verified %}
                                <span class="badge-verifie">‚úì V√©rifi√©</span>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td class="col-note">
                        <div class="note-display">
                            {% for i in "12345" %}
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="{% if forloop.counter <= avis.note %}currentColor{% else %}none{% endif %}" 
                                 stroke="currentColor" stroke-width="2" 
                                 class="note-star {% if forloop.counter <= avis.note %}{% if avis.note >= 4 %}note-vert{% elif avis.note >= 3 %}note-orange{% else %}note-rouge{% endif %}{% endif %}">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                            {% endfor %}
                            <span class="note-value">{{ avis.note }}/5</span>
                        </div>
                    </td>
                    <td class="col-logement">
                        <div class="logement-cell">
                            <div class="logement-thumbnail">üì∑</div>
                            <div class="logement-info">
                                <a href="/connect-admin/logements/{{ avis.logement.id }}/" class="logement-link">
                                    {{ avis.logement.titre|truncatewords:5 }}
                                </a>
                                <div class="logement-address">{{ avis.logement.adresse|truncatewords:3 }}</div>
                            </div>
                        </div>
                    </td>
                    <td class="col-type">
                        <span class="type-badge type-logement">Logement</span>
                    </td>
                    <td class="col-contenu">
                        <div class="contenu-apercu" title="{{ avis.commentaire }}">
                            {{ avis.commentaire|truncatewords:15 }}
                        </div>
                    </td>
                    <td class="col-date">{{ avis.date_avis|timesince }}</td>
                    <td class="col-statut">
                        {% if avis.verifie %}
                        <span class="statut-badge statut-verifie">Publi√©</span>
                        {% else %}
                        <span class="statut-badge statut-en_attente">En attente</span>
                        {% endif %}
                    </td>
                    <td class="col-reponse">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="gray" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </td>
                    <td class="col-utilite">
                        <div class="utilite-display">
                            <span class="thumbs-up">üëç 0</span>
                            <span class="thumbs-down">üëé 0</span>
                        </div>
                    </td>
                    <td class="col-actions sticky-right">
                        <div class="actions-dropdown">
                            <button class="actions-btn" onclick="toggleActionsDropdown(this)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="1"></circle>
                                    <circle cx="12" cy="5" r="1"></circle>
                                    <circle cx="12" cy="19" r="1"></circle>
                                </svg>
                            </button>
                            <div class="dropdown-menu">
                                <a href="#" class="dropdown-item" onclick="openAvisDetail({{ avis.id }})">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    Voir d√©tail complet
                                </a>
                                {% if not avis.verifie %}
                                <a href="#" class="dropdown-item" onclick="approuverAvis({{ avis.id }})">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="green" stroke-width="2">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                    Approuver/Publier
                                </a>
                                {% endif %}
                                <a href="#" class="dropdown-item" onclick="masquerAvis({{ avis.id }})">
                                    Masquer avis
                                </a>
                                <div class="dropdown-divider"></div>
                                <a href="#" class="dropdown-item dropdown-danger" onclick="supprimerAvis({{ avis.id }})">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                    Supprimer
                                </a>
                            </div>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="12" class="empty-state">
                        <p>Aucun avis trouv√©</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if avis.has_other_pages %}
    <div class="pagination-wrapper">
        <div class="pagination-info">
            <select class="per-page-select" onchange="changePerPage(this.value)">
                <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
                <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                <option value="250" {% if per_page == 250 %}selected{% endif %}>250</option>
            </select>
            <span class="pagination-text">
                Affichage {{ avis.start_index }}-{{ avis.end_index }} sur {{ avis.paginator.count|intcomma }} avis
            </span>
        </div>
        <div class="pagination-controls">
            {% if avis.has_previous %}
            <a href="?page={{ avis.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">Pr√©c√©dent</a>
            {% endif %}
            {% for num in avis.paginator.page_range %}
                {% if avis.number == num %}
                <span class="page-current">{{ num }}</span>
                {% elif num > avis.number|add:'-3' and num < avis.number|add:'3' %}
                <a href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">{{ num }}</a>
                {% endif %}
            {% endfor %}
            {% if avis.has_next %}
            <a href="?page={{ avis.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">Suivant</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

