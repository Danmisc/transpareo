{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ logement.titre }} - Transpareo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #D3580B;
            --primary-hover: #c4510a;
            --text-primary: #222222;
            --text-secondary: #717171;
            --border: #DDDDDD;
            --background: #FFFFFF;
            --background-alt: #F7F7F7;
            --error: #C13515;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: var(--text-primary);
            background: var(--background);
            line-height: 1.5;
        }

        /* ========== NAVBAR ========== */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            z-index: 1000;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .navbar.scrolled {
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.12);
        }

        .navbar-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            font-weight: 800;
            font-size: 20px;
            color: #1a1a1a;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .logo-text {
            background: linear-gradient(135deg, #D3580B 0%, #c4510a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .navbar-logo:hover {
            transform: translateY(-2px);
        }

        .nav-center {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 0;
            align-items: center;
            flex: 1;
            justify-content: center;
        }

        .nav-link {
            color: #333;
            text-decoration: none;
            padding: 10px 16px;
            font-weight: 500;
            font-size: 14px;
            border-radius: 6px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-link:hover {
            background: rgba(0, 0, 0, 0.04);
            color: #D3580B;
        }

        .dropdown {
            position: relative;
            z-index: 1500;
        }

        .dropbtn {
            background: transparent;
            border: none;
            color: #333;
            padding: 10px 16px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .dropbtn:hover {
            background: rgba(0, 0, 0, 0.04);
            color: #D3580B;
        }

        .dropdown-chevron {
            font-size: 0.75em;
            transition: transform 0.3s ease;
            display: inline-flex;
        }

        .dropdown:hover .dropdown-chevron,
        .dropbtn[aria-expanded="true"] .dropdown-chevron {
            transform: rotate(180deg);
        }

        .dropdown-content {
            position: absolute;
            top: calc(100% + 16px);
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05), 0 8px 24px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.06);
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            min-width: 920px;
            max-width: 1000px;
            z-index: 10;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            overflow: hidden;
        }

        .dropdown-content::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            width: 12px;
            height: 12px;
            background: white;
            border-top: 1px solid rgba(0, 0, 0, 0.06);
            border-left: 1px solid rgba(0, 0, 0, 0.06);
            box-shadow: -2px -2px 8px rgba(0, 0, 0, 0.08);
        }

        .dropdown:hover .dropdown-content,
        .dropbtn[aria-expanded="true"] ~ .dropdown-content,
        .dropdown-content[aria-hidden="false"] {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
            transform: translateX(-50%) translateY(0);
        }

        .dropdown-inner {
            display: flex;
            gap: 0;
            padding: 0;
            height: 100%;
            border-radius: 20px;
            overflow: hidden;
            min-height: 400px;
        }

        .connect-section {
            width: 38%;
            padding: 40px;
            background: linear-gradient(135deg, rgba(211, 88, 11, 0.04) 0%, rgba(211, 88, 11, 0.01) 100%);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
            border-right: 1px solid rgba(0, 0, 0, 0.06);
        }

        .connect-section h3 {
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0 0 12px 0;
        }

        .connect-section p {
            font-size: 14px;
            color: #666;
            line-height: 1.7;
            margin: 0;
        }

        .connect-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 16px;
            margin: 24px 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .btn-more {
            color: #D3580B;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: auto;
        }

        .features-section {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            background: white;
        }

        .features-title {
            font-size: 18px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0 0 28px 0;
        }

        .feature-category {
            margin-bottom: 28px;
        }

        .feature-category-title {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #1a1a1a;
            margin-bottom: 12px;
        }

        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .feature-list a {
            font-size: 14px;
            color: #555;
            text-decoration: none;
            padding: 10px 14px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .feature-list a:hover {
            background: rgba(211, 88, 11, 0.06);
            color: #D3580B;
        }

        .user {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 12px;
            align-items: center;
            flex-shrink: 0;
        }

        .user-profile-dropdown {
            position: relative;
            list-style: none;
        }

        .user-profile-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            background: transparent;
            border: none;
            padding: 6px 12px 6px 6px;
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .user-profile-btn:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .user-avatar-placeholder {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #D3580B 0%, #c4510a 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .user-username {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .user-dropdown-chevron {
            color: #666;
            transition: all 0.3s ease;
            opacity: 0.6;
        }

        .user-profile-btn:hover .user-dropdown-chevron {
            opacity: 1;
            color: #D3580B;
        }

        .user-dropdown-content {
            position: absolute;
            top: calc(100% + 16px);
            right: 0;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05), 0 8px 24px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.06);
            min-width: 240px;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 1000;
            padding: 8px 0;
            transform: translateY(-8px);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .user-profile-dropdown:hover .user-dropdown-content,
        .user-profile-btn[aria-expanded="true"] ~ .user-dropdown-content {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
            transform: translateY(0);
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #333;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .user-dropdown-item:hover {
            background: rgba(211, 88, 11, 0.06);
            color: #D3580B;
        }

        .user-dropdown-divider {
            height: 1px;
            background: rgba(0, 0, 0, 0.06);
            margin: 8px 0;
        }

        .btn-login, .btn-signup {
            padding: 10px 20px;
            border-radius: 22px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .btn-login {
            color: #333;
        }

        .btn-login:hover {
            background: rgba(0, 0, 0, 0.04);
        }

        .btn-signup {
            background: var(--primary);
            color: white;
        }

        .btn-signup:hover {
            background: var(--primary-hover);
        }

        .navbar-spacer {
            height: 70px;
        }

        /* ========== GALLERY ========== */
        .gallery-section {
            position: relative;
            width: 100%;
            height: 65vh;
            min-height: 550px;
            max-height: 850px;
            margin-bottom: 64px;
            border-radius: 0;
            overflow: hidden;
            margin-top: 70px;
        }

        .gallery-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            height: 100%;
        }

        .gallery-main {
            position: relative;
            overflow: hidden;
            border-radius: 0;
        }

        .gallery-main img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .gallery-main img:hover {
            transform: scale(1.02);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .gallery-thumb {
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .gallery-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .gallery-thumb:hover img {
            transform: scale(1.05);
        }

        .gallery-thumb::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0);
            transition: background 0.3s ease;
        }

        .gallery-thumb:hover::after {
            background: rgba(0, 0, 0, 0.1);
        }

        .gallery-show-all {
            position: absolute;
            bottom: 24px;
            right: 24px;
            background: white;
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .gallery-show-all:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }

        .gallery-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border: none;
            z-index: 10;
            transition: all 0.2s ease;
        }

        .gallery-nav:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            transform: translateY(-50%) scale(1.1);
        }

        .gallery-nav.prev {
            left: 24px;
        }

        .gallery-nav.next {
            right: 24px;
        }

        /* ========== LIGHTBOX ========== */
        .lightbox {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            flex-direction: column;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox-header {
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .lightbox-close {
            background: none;
            border: none;
            color: white;
            font-size: 32px;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .lightbox-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .lightbox-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 40px;
        }

        .lightbox-image {
            max-width: 90%;
            max-height: 90vh;
            object-fit: contain;
        }

        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            color: white;
            font-size: 24px;
            transition: all 0.2s ease;
        }

        .lightbox-nav:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) scale(1.1);
        }

        .lightbox-nav.prev {
            left: 40px;
        }

        .lightbox-nav.next {
            right: 40px;
        }

        .lightbox-counter {
            color: white;
            font-size: 14px;
            margin-top: 20px;
            text-align: center;
        }

        /* ========== MAIN CONTENT ========== */
        .main-container {
            max-width: 1760px;
            margin: 0 auto;
            padding: 0 80px;
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 80px;
        }

        .content-main {
            max-width: 1120px;
        }

        .content-sidebar {
            position: sticky;
            top: 90px;
            height: fit-content;
        }

        /* ========== HEADER INFO ========== */
        .header-info {
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 32px;
        }

        .header-info-title {
            font-size: 26px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .header-info-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }

        .header-info-location {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text-secondary);
            font-size: 14px;
            text-decoration: underline;
            cursor: pointer;
        }

        .header-info-location:hover {
            color: var(--text-primary);
        }

        .header-info-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
        }

        .header-info-rating .stars {
            color: var(--primary);
        }

        .header-info-host {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .header-info-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
        }

        .badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            background: var(--background-alt);
            color: var(--text-primary);
        }

        .badge.verified {
            background: #E8F5E9;
            color: #2E7D32;
        }

        /* ========== STATS GRID ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            padding: 32px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 32px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .stat-item-icon {
            font-size: 24px;
        }

        .stat-item-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .stat-item-value {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* ========== DESCRIPTION ========== */
        .description-section {
            margin-bottom: 48px;
        }

        .description-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .description-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .description-content {
            font-size: 16px;
            line-height: 1.6;
            color: var(--text-primary);
            white-space: pre-wrap;
        }

        .description-content.expanded {
            max-height: none;
        }

        .description-content.collapsed {
            max-height: 200px;
            overflow: hidden;
            position: relative;
        }

        .description-content.collapsed::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(transparent, white);
        }

        .description-toggle {
            margin-top: 16px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            text-decoration: underline;
            padding: 0;
        }

        /* ========== AMENITIES ========== */
        .amenities-section {
            margin-bottom: 48px;
        }

        .amenities-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 24px;
        }

        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .amenity-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .amenity-item:hover {
            border-color: var(--text-primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .amenity-icon {
            font-size: 24px;
            width: 32px;
            text-align: center;
        }

        .amenity-label {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* ========== MAP SECTION ========== */
        .map-section {
            margin-bottom: 64px;
        }

        .map-section-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .map-section-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 24px;
            text-decoration: underline;
            cursor: pointer;
            display: inline-block;
        }

        .map-section-subtitle:hover {
            color: var(--text-primary);
        }

        #map {
            width: 100%;
            height: 500px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        /* Custom marker style */
        .custom-marker {
            background: var(--primary);
            width: 32px;
            height: 32px;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .custom-marker::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
        }

        /* Custom popup style */
        .custom-popup .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            padding: 0;
        }

        .custom-popup .leaflet-popup-content {
            margin: 0;
            padding: 12px;
        }

        .custom-popup .leaflet-popup-tip {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* ========== REVIEWS SECTION ========== */
        .reviews-section {
            margin-bottom: 48px;
            border-top: 1px solid var(--border);
            padding-top: 48px;
        }

        .reviews-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 32px;
        }

        .reviews-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .reviews-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
            margin-top: 24px;
        }

        .review-stat {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }

        .review-stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .review-stat-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .review-stat-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        .review-stat-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .reviews-list {
            display: flex;
            flex-direction: column;
            gap: 48px;
        }

        .review-item {
            padding-bottom: 48px;
            border-bottom: 1px solid var(--border);
        }

        .review-item:last-child {
            border-bottom: none;
        }

        .review-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 16px;
        }

        .review-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--background-alt);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            flex-shrink: 0;
        }

        .review-info {
            flex: 1;
        }

        .review-author {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .review-date {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .review-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .review-rating .stars {
            color: var(--primary);
            font-size: 14px;
        }

        .review-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .review-content {
            font-size: 16px;
            line-height: 1.6;
            color: var(--text-primary);
            white-space: pre-wrap;
        }

        .review-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 16px;
            padding: 16px;
            background: var(--background-alt);
            border-radius: 12px;
        }

        .review-detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .review-detail-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .review-detail-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* ========== SIDEBAR ========== */
        .sidebar-card {
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            background: white;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }

        .sidebar-price {
            display: flex;
            align-items: baseline;
            gap: 4px;
            margin-bottom: 24px;
        }

        .sidebar-price-value {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .sidebar-price-unit {
            font-size: 16px;
            color: var(--text-secondary);
        }

        .sidebar-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .btn-sidebar {
            width: 100%;
            padding: 14px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-sidebar-primary {
            background: var(--primary);
            color: white;
        }

        .btn-sidebar-primary:hover {
            background: var(--primary-hover);
        }

        .btn-sidebar-secondary {
            background: white;
            color: var(--text-primary);
            border: 1px solid var(--text-primary);
        }

        .btn-sidebar-secondary:hover {
            background: var(--text-primary);
            color: white;
        }

        .sidebar-info {
            padding-top: 24px;
            border-top: 1px solid var(--border);
            margin-top: 24px;
        }

        .sidebar-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            font-size: 14px;
        }

        .sidebar-info-label {
            color: var(--text-secondary);
        }

        .sidebar-info-value {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Candidature Status (Phase 14.3) */
        .candidature-status {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e5e5e5;
            margin-bottom: 12px;
        }
        
        .candidature-status-badge {
            font-weight: 600;
            color: #27ae60;
            font-size: 14px;
        }
        
        .candidature-status-text {
            font-size: 13px;
            color: #666;
        }

        /* ========== SIMILAR PROPERTIES ========== */
        .similar-section {
            margin-top: 64px;
            border-top: 1px solid var(--border);
            padding-top: 48px;
        }

        .similar-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 32px;
        }

        .similar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
        }

        .similar-card {
            cursor: pointer;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .similar-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-4px);
        }

        .similar-card-image {
            width: 100%;
            height: 240px;
            object-fit: cover;
        }

        .similar-card-content {
            padding: 16px;
        }

        .similar-card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .similar-card-location {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .similar-card-price {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* ========== CONNECT OWNER SECTION (Phase 14.1) ========== */
        .connect-owner-section {
            margin-top: 64px;
            border-top: 1px solid var(--border);
            padding-top: 48px;
        }

        .connect-owner-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 24px;
        }

        .connect-owner-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .connect-owner-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .connect-owner-avatar,
        .connect-owner-avatar-placeholder {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .connect-owner-avatar-placeholder {
            background: linear-gradient(135deg, #D3580B 0%, #c4510a 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 24px;
        }

        .connect-owner-info {
            flex: 1;
        }

        .connect-owner-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .connect-owner-link {
            color: var(--text-primary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .connect-owner-link:hover {
            color: var(--primary);
        }

        .connect-owner-badge {
            font-size: 14px;
            color: #D3580B;
            display: inline-flex;
            align-items: center;
        }

        .connect-owner-status {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0;
        }

        .connect-owner-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-connect-view {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
        }

        .btn-connect-view:hover {
            background: var(--primary-hover);
        }

        .btn-connect-follow {
            padding: 10px 20px;
            background: white;
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-connect-follow:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-connect-following {
            background: var(--background-alt);
            border-color: var(--primary);
            color: var(--primary);
        }

        .connect-owner-posts {
            margin-top: 24px;
        }

        .connect-owner-posts-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .connect-owner-posts-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .connect-owner-post-item {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
        }

        .connect-owner-post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .connect-owner-post-date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .connect-owner-post-content {
            margin-bottom: 12px;
        }

        .connect-owner-post-content p {
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.6;
            margin: 0;
        }

        .connect-owner-post-image {
            margin-top: 12px;
            border-radius: 8px;
            overflow: hidden;
        }

        .connect-owner-post-image img {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
        }

        .connect-owner-post-link {
            font-size: 14px;
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }

        .connect-owner-post-link:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 1120px) {
            .main-container {
                grid-template-columns: 1fr;
                padding: 0 40px;
            }

            .content-sidebar {
                position: relative;
                top: 0;
                order: -1;
            }

            .gallery-section {
                height: 50vh;
                min-height: 400px;
            }

            .gallery-container {
                grid-template-columns: 1fr;
            }

            .gallery-grid {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 0 24px;
            }

            .header-sticky {
                padding: 12px 24px;
            }

            .gallery-section {
                height: 40vh;
                min-height: 300px;
            }

            .header-info-title {
                font-size: 22px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .amenities-grid {
                grid-template-columns: 1fr;
            }

            .similar-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ========== NAVBAR ========== -->
    <nav class="navbar" id="navbar">
        <!-- Logo -->
        <a href="{% url 'landing-page' %}" id="logo" class="navbar-logo">
            <span class="logo-text">Transpareo</span>
        </a>

        <!-- Navigation Center -->
        <ul class="nav-center">
            <!-- Dropdown Locataire -->
            <li class="dropdown">
                <button class="dropbtn" aria-haspopup="true" aria-expanded="false" aria-controls="dropdown-locataire">
                    Je suis locataire
                    <span class="dropdown-chevron">▾</span>
                </button>
                <div id="dropdown-locataire" class="dropdown-content" role="menu" aria-hidden="true">
                    <div class="dropdown-inner">
                        <div class="connect-section">
                            <div class="connect-header">
                                <h3>Transpareo Connect</h3>
                                <p>Découvrez un réseau social qui met en relation directe propriétaires et locataires grâce à des fonctionnalités innovantes.</p>
                            </div>
                            <img src="{% static 'images/transpareo-connect.jpg' %}" alt="Illustration Transpareo Connect" class="connect-image" onerror="this.style.display='none';" />
                            <a href="" class="btn-more">En savoir plus →</a>
                        </div>
                        <div class="features-section">
                            <h3 class="features-title">Fonctionnalités locataire</h3>
                            <div class="feature-category">
                                <h4 class="feature-category-title">Noter et trouver un logement</h4>
                                <ul class="feature-list">
                                    <li><a href="{% url 'ajouter-avis' logement.id %}">Noter votre location</a></li>
                                    <li><a href="{% url 'map' %}">Trouver votre futur logement</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </li>

            <!-- Dropdown Propriétaire -->
            <li class="dropdown">
                <button class="dropbtn" aria-haspopup="true" aria-expanded="false" aria-controls="dropdown-proprietaire">
                    Je suis propriétaire
                    <span class="dropdown-chevron">▾</span>
                </button>
                <div id="dropdown-proprietaire" class="dropdown-content" role="menu" aria-hidden="true">
                    <div class="dropdown-inner">
                        <div class="connect-section">
                            <div class="connect-header">
                                <h3>Transpareo Connect</h3>
                                <p>Découvrez un réseau social qui met en relation directe propriétaires et locataires grâce à des fonctionnalités innovantes.</p>
                            </div>
                            <img src="{% static 'images/transpareo-connect.jpg' %}" alt="Illustration Transpareo Connect" class="connect-image" onerror="this.style.display='none';" />
                            <a href="" class="btn-more">En savoir plus →</a>
                        </div>
                        <div class="features-section">
                            <h3 class="features-title">Fonctionnalités propriétaire</h3>
                            <div class="feature-category">
                                <h4 class="feature-category-title">Mettre en avant son bien</h4>
                                <ul class="feature-list">
                                    <li><a href="{% url 'reclamer-bien' logement.id %}">Réclamer ce bien</a></li>
                                    <li><a href="{% url 'mes-biens' %}">Mes biens</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </li>

            <!-- Simple Links -->
            <li><a href="{% url 'map' %}" class="nav-link">Carte</a></li>
            <li><a href="{% url 'liste' %}" class="nav-link">Liste</a></li>
        </ul>

        <!-- User Section -->
        <ul class="user">
            {% if user.is_authenticated %}
                <li class="user-profile-dropdown">
                    <button class="user-profile-btn" aria-haspopup="true" aria-expanded="false">
                        {% if user.avatar %}
                            <img src="{{ user.avatar.url }}" alt="{{ user.username }}" class="user-avatar">
                        {% else %}
                            <div class="user-avatar-placeholder">{{ user.username|first|upper }}</div>
                        {% endif %}
                        <span class="user-username">{{ user.username }}</span>
                        <svg class="user-dropdown-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="user-dropdown-content" role="menu" aria-hidden="true">
                        <a href="{% url 'profile' %}" class="user-dropdown-item">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <span>Gérer mon compte</span>
                        </a>
                        <div class="user-dropdown-divider"></div>
                        <a href="{% url 'logout' %}" class="user-dropdown-item">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            <span>Se déconnecter</span>
                        </a>
                    </div>
                </li>
            {% else %}
                <li>
                    <a href="{% url 'login' %}" class="btn-login">Se connecter</a>
                </li>
                <li>
                    <a href="{% url 'signup' %}" class="btn-signup">S'inscrire</a>
                </li>
            {% endif %}
        </ul>
    </nav>

    <div class="navbar-spacer"></div>

    <!-- Gallery -->
    <div class="gallery-section">
        {% if images %}
        <div class="gallery-container">
            <div class="gallery-main">
                <img src="{{ images.0.image.url }}" alt="{{ images.0.titre|default:logement.titre }}" id="gallery-main-img">
                {% if images|length > 5 %}
                <button class="gallery-show-all" onclick="openLightbox(0)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    Afficher toutes les photos
                </button>
                {% endif %}
                {% if images|length > 1 %}
                <button class="gallery-nav prev" onclick="changeGalleryImage(-1)">‹</button>
                <button class="gallery-nav next" onclick="changeGalleryImage(1)">›</button>
                {% endif %}
            </div>
            {% if images|length > 1 %}
            <div class="gallery-grid">
                {% for image in images|slice:":4" %}
                <div class="gallery-thumb" onclick="changeGalleryImage({{ forloop.counter0 }})">
                    <img src="{{ image.image.url }}" alt="{{ image.titre|default:logement.titre }}">
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% else %}
        <div class="gallery-main">
            <img src="https://via.placeholder.com/1200x800?text=Logement" alt="{{ logement.titre }}">
        </div>
        {% endif %}
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <div class="lightbox-header">
            <span id="lightbox-counter">1 / {{ images|length }}</span>
            <button class="lightbox-close" onclick="closeLightbox()">×</button>
        </div>
        <div class="lightbox-content">
            {% if images|length > 1 %}
            <button class="lightbox-nav prev" onclick="changeLightboxImage(-1)">‹</button>
            <button class="lightbox-nav next" onclick="changeLightboxImage(1)">›</button>
            {% endif %}
            <img class="lightbox-image" id="lightbox-image" src="" alt="">
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <div class="content-main">
            <!-- Header Info -->
            <div class="header-info">
                <h1 class="header-info-title">{{ logement.titre }}</h1>
                <div class="header-info-meta">
                    <div class="header-info-location" onclick="scrollToMap()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        {{ logement.adresse }}, {{ logement.code_postal }}
                    </div>
                    {% if note_moyenne > 0 %}
                    <div class="header-info-rating">
                        <span class="stars">⭐</span>
                        <span>{{ note_moyenne|floatformat:1 }}</span>
                        <span>({{ avis_count }} avis)</span>
                    </div>
                    {% endif %}
                    {% if logement.proprietaire %}
                    <div class="header-info-host">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Propriétaire vérifié
                    </div>
                    {% endif %}
                </div>
                <div class="header-info-badges">
                    {% if logement.proprietaire %}
                    <div class="badge verified">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Propriétaire vérifié
                    </div>
                    {% endif %}
                    <div class="badge">
                        {{ logement.get_type_logement_display }}
                    </div>
                    <div class="badge">
                        {{ logement.get_etage_display }}
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-item-icon">💰</div>
                    <div class="stat-item-label">Prix mensuel</div>
                    <div class="stat-item-value">{{ logement.prix }}€</div>
                </div>
                <div class="stat-item">
                    <div class="stat-item-icon">📐</div>
                    <div class="stat-item-label">Surface</div>
                    <div class="stat-item-value">{{ logement.surface|floatformat:0 }}m²</div>
                </div>
                <div class="stat-item">
                    <div class="stat-item-icon">🛏️</div>
                    <div class="stat-item-label">Chambres</div>
                    <div class="stat-item-value">{{ logement.chambres }}</div>
                </div>
                {% if note_moyenne > 0 %}
                <div class="stat-item">
                    <div class="stat-item-icon">⭐</div>
                    <div class="stat-item-label">Note moyenne</div>
                    <div class="stat-item-value">{{ note_moyenne|floatformat:1 }}/5</div>
                </div>
                {% endif %}
            </div>

            <!-- Description -->
            {% if logement.description %}
            <div class="description-section">
                <div class="description-header">
                    <h2 class="description-title">À propos de ce logement</h2>
                </div>
                <div class="description-content collapsed" id="description-content">
                    {{ logement.description }}
                </div>
                <button class="description-toggle" onclick="toggleDescription()" id="description-toggle">
                    Afficher plus
                </button>
            </div>
            {% endif %}

            <!-- Amenities -->
            <div class="amenities-section">
                <h2 class="amenities-title">Ce que propose ce logement</h2>
                <div class="amenities-grid">
                    <div class="amenity-item">
                        <div class="amenity-icon">🛏️</div>
                        <div class="amenity-label">{{ logement.chambres }} chambre{{ logement.chambres|pluralize }}</div>
                    </div>
                    <div class="amenity-item">
                        <div class="amenity-icon">📐</div>
                        <div class="amenity-label">{{ logement.surface|floatformat:0 }}m² de surface</div>
                    </div>
                    <div class="amenity-item">
                        <div class="amenity-icon">🏢</div>
                        <div class="amenity-label">{{ logement.get_type_logement_display }}</div>
                    </div>
                    <div class="amenity-item">
                        <div class="amenity-icon">📊</div>
                        <div class="amenity-label">{{ logement.get_etage_display }}</div>
                    </div>
                    {% if logement.proprietaire %}
                    <div class="amenity-item">
                        <div class="amenity-icon">✓</div>
                        <div class="amenity-label">Propriétaire vérifié</div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Map -->
            <div class="map-section">
                <h2 class="map-section-title">Où vous serez</h2>
                <p class="map-section-subtitle">{{ logement.adresse }}, {{ logement.code_postal }}</p>
                <div id="map"></div>
            </div>

            <!-- Reviews -->
            <div class="reviews-section">
                <div class="reviews-header">
                    <div>
                        <h2 class="reviews-title">
                            <span class="stars">⭐</span>
                            {{ note_moyenne|floatformat:1 }} · {{ avis_count }} avis
                        </h2>
                        {% if stats_avis.note_proprete or stats_avis.note_equipements or stats_avis.note_localisation or stats_avis.note_bailleur %}
                        <div class="reviews-stats">
                            {% if stats_avis.note_proprete %}
                            <div class="review-stat">
                                <div class="review-stat-label">Propreté</div>
                                <div class="review-stat-value">{{ stats_avis.note_proprete|floatformat:1 }}</div>
                                <div class="review-stat-bar">
                                    <div class="review-stat-fill" style="width: {{ stats_avis.note_proprete_width }}%"></div>
                                </div>
                            </div>
                            {% endif %}
                            {% if stats_avis.note_equipements %}
                            <div class="review-stat">
                                <div class="review-stat-label">Équipements</div>
                                <div class="review-stat-value">{{ stats_avis.note_equipements|floatformat:1 }}</div>
                                <div class="review-stat-bar">
                                    <div class="review-stat-fill" style="width: {{ stats_avis.note_equipements_width }}%"></div>
                                </div>
                            </div>
                            {% endif %}
                            {% if stats_avis.note_localisation %}
                            <div class="review-stat">
                                <div class="review-stat-label">Localisation</div>
                                <div class="review-stat-value">{{ stats_avis.note_localisation|floatformat:1 }}</div>
                                <div class="review-stat-bar">
                                    <div class="review-stat-fill" style="width: {{ stats_avis.note_localisation_width }}%"></div>
                                </div>
                            </div>
                            {% endif %}
                            {% if stats_avis.note_bailleur %}
                            <div class="review-stat">
                                <div class="review-stat-label">Bailleur</div>
                                <div class="review-stat-value">{{ stats_avis.note_bailleur|floatformat:1 }}</div>
                                <div class="review-stat-bar">
                                    <div class="review-stat-fill" style="width: {{ stats_avis.note_bailleur_width }}%"></div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="reviews-list">
                    {% if avis %}
                        {% for avi in avis %}
                        <div class="review-item">
                            <div class="review-header">
                                <div class="review-avatar">
                                    {{ avi.locataire.username|first|upper }}
                                </div>
                                <div class="review-info">
                                    <div class="review-author">{{ avi.locataire.username }}</div>
                                    <div class="review-date">{{ avi.date_avis|date:"F Y" }}</div>
                                    <div class="review-rating">
                                        <span class="stars">{% for i in "12345" %}{% if forloop.counter <= avi.note %}⭐{% endif %}{% endfor %}</span>
                                    </div>
                                </div>
                            </div>
                            <h3 class="review-title">{{ avi.titre }}</h3>
                            <p class="review-content">{{ avi.commentaire }}</p>
                            {% if avi.note_proprete or avi.note_equipements or avi.note_localisation or avi.note_bailleur %}
                            <div class="review-details">
                                {% if avi.note_proprete %}
                                <div class="review-detail-item">
                                    <div class="review-detail-label">Propreté</div>
                                    <div class="review-detail-value">{{ avi.note_proprete }}⭐</div>
                                </div>
                                {% endif %}
                                {% if avi.note_equipements %}
                                <div class="review-detail-item">
                                    <div class="review-detail-label">Équipements</div>
                                    <div class="review-detail-value">{{ avi.note_equipements }}⭐</div>
                                </div>
                                {% endif %}
                                {% if avi.note_localisation %}
                                <div class="review-detail-item">
                                    <div class="review-detail-label">Localisation</div>
                                    <div class="review-detail-value">{{ avi.note_localisation }}⭐</div>
                                </div>
                                {% endif %}
                                {% if avi.note_bailleur %}
                                <div class="review-detail-item">
                                    <div class="review-detail-label">Bailleur</div>
                                    <div class="review-detail-value">{{ avi.note_bailleur }}⭐</div>
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% else %}
                        <div style="text-align: center; padding: 48px; color: var(--text-secondary);">
                            <p style="font-size: 16px; margin-bottom: 8px;">Aucun avis pour l'instant</p>
                            <p style="font-size: 14px;">Soyez le premier à laisser un avis sur ce logement !</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Similar Properties -->
            {% if logements_similaires %}
            <div class="similar-section">
                <h2 class="similar-title">Logements similaires</h2>
                <div class="similar-grid">
                    {% for similar in logements_similaires %}
                    <div class="similar-card" onclick="window.location.href='{% url 'logement-detail' similar.id %}'">
                        {% if similar.images.first %}
                        <img src="{{ similar.images.first.image.url }}" alt="{{ similar.titre }}" class="similar-card-image">
                        {% else %}
                        <img src="https://via.placeholder.com/400x300?text=Logement" alt="{{ similar.titre }}" class="similar-card-image">
                        {% endif %}
                        <div class="similar-card-content">
                            <div class="similar-card-title">{{ similar.titre }}</div>
                            <div class="similar-card-location">{{ similar.adresse }}, {{ similar.code_postal }}</div>
                            <div class="similar-card-price">{{ similar.prix }}€/mois</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Intégration Connect - Propriétaire (Phase 14.1) -->
        {% if proprietaire_connect_info %}
        <div class="connect-owner-section">
            <h2 class="connect-owner-title">À propos du propriétaire</h2>
            <div class="connect-owner-card">
                <div class="connect-owner-header">
                    {% if proprietaire_connect_info.avatar %}
                    <img src="{{ proprietaire_connect_info.avatar }}" alt="{{ proprietaire_connect_info.full_name }}" class="connect-owner-avatar">
                    {% else %}
                    <div class="connect-owner-avatar-placeholder">{{ proprietaire_connect_info.full_name|first|upper }}</div>
                    {% endif %}
                    <div class="connect-owner-info">
                        <h3 class="connect-owner-name">
                            <a href="{{ proprietaire_connect_info.connect_profile_url }}" class="connect-owner-link">
                                {{ proprietaire_connect_info.full_name }}
                            </a>
                            {% if proprietaire_connect_info.identity_verified %}
                            <span class="connect-owner-badge" title="Identité vérifiée">✓</span>
                            {% endif %}
                            {% if proprietaire_connect_info.proprietaire_verified %}
                            <span class="connect-owner-badge" title="Propriétaire vérifié">🏠</span>
                            {% endif %}
                        </h3>
                        <p class="connect-owner-status">🏠 Propriétaire vérifié</p>
                    </div>
                </div>
                <div class="connect-owner-actions">
                    <a href="{{ proprietaire_connect_info.connect_profile_url }}" class="btn-connect-view">
                        Voir le profil Connect
                    </a>
                    {% if user.is_authenticated and user.id != proprietaire_connect_info.id %}
                    <button class="btn-connect-follow {% if is_following_owner %}btn-connect-following{% endif %}" onclick="toggleFollowOwner({{ proprietaire_connect_info.id }})" id="follow-owner-btn">
                        {% if is_following_owner %}
                        ✓ Suivi
                        {% else %}
                        + Suivre ce propriétaire
                        {% endif %}
                    </button>
                    {% endif %}
                </div>
            </div>
            
            <!-- Posts récents du propriétaire -->
            {% if owner_posts %}
            <div class="connect-owner-posts">
                <h3 class="connect-owner-posts-title">Publications récentes</h3>
                <div class="connect-owner-posts-list">
                    {% for post in owner_posts %}
                    <div class="connect-owner-post-item">
                        <div class="connect-owner-post-header">
                            <span class="connect-owner-post-date">{{ post.created_at|timesince }}</span>
                        </div>
                        <div class="connect-owner-post-content">
                            <p>{{ post.content|truncatewords:30 }}</p>
                            {% if post.images.all %}
                            <div class="connect-owner-post-image">
                                <img src="{{ post.images.first.image.url }}" alt="Image">
                            </div>
                            {% endif %}
                        </div>
                        <a href="{% url 'connect-home' %}#post-{{ post.id }}" class="connect-owner-post-link">Voir sur Connect →</a>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Sidebar -->
        <div class="content-sidebar">
            <div class="sidebar-card" id="sidebar-card">
                <div class="sidebar-price">
                    <span class="sidebar-price-value">{{ logement.prix }}€</span>
                    <span class="sidebar-price-unit">/mois</span>
                </div>

                <div class="sidebar-actions">
                    {% if user.is_authenticated %}
                        {% if peut_reclamer %}
                        <a href="{% url 'reclamer-bien' logement.id %}" class="btn-sidebar btn-sidebar-primary">
                            🏠 Je suis le propriétaire
                        </a>
                        {% endif %}
                        
                        {% if logement.proprietaire and user != logement.proprietaire and not est_candidat %}
                        <a href="{% url 'candidater-logement' logement.id %}" class="btn-sidebar btn-sidebar-primary">
                            📝 Candidater pour ce logement
                        </a>
                        {% elif est_candidat %}
                        <div class="candidature-status">
                            <span class="candidature-status-badge">
                                ✓ Candidature envoyée
                            </span>
                            <span class="candidature-status-text">Statut: {{ statut_candidature|capfirst }}</span>
                        </div>
                        {% endif %}
                        
                        {% if peut_laisser_avis %}
                        <a href="{% url 'ajouter-avis' logement.id %}" class="btn-sidebar btn-sidebar-secondary">
                            ✍️ Laisser un avis
                        </a>
                        {% endif %}

                        <button class="btn-sidebar btn-sidebar-secondary" id="btn-favorite">
                            {% if est_favori %}
                            ❤️ Retirer des favoris
                            {% else %}
                            🤍 Enregistrer
                            {% endif %}
                        </button>

                        <button class="btn-sidebar btn-sidebar-secondary" onclick="shareProperty()">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 10c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm0 1c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm10-1c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm0 1c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zM8 9l6-4M8 11l6 4"/>
                            </svg>
                            Partager
                        </button>
                    {% else %}
                        <a href="{% url 'login' %}?next={% url 'logement-detail' logement.id %}" class="btn-sidebar btn-sidebar-primary">
                            🔐 Se connecter pour candidater
                        </a>
                        <p style="text-align: center; margin-top: 12px; font-size: 14px; color: var(--text-secondary);">
                            Connectez-vous pour candidater à ce bien
                        </p>
                    {% endif %}
                </div>

                <div class="sidebar-info">
                    <div class="sidebar-info-item">
                        <span class="sidebar-info-label">Type</span>
                        <span class="sidebar-info-value">{{ logement.get_type_logement_display }}</span>
                    </div>
                    <div class="sidebar-info-item">
                        <span class="sidebar-info-label">Surface</span>
                        <span class="sidebar-info-value">{{ logement.surface|floatformat:0 }}m²</span>
                    </div>
                    <div class="sidebar-info-item">
                        <span class="sidebar-info-label">Chambres</span>
                        <span class="sidebar-info-value">{{ logement.chambres }}</span>
                    </div>
                    <div class="sidebar-info-item">
                        <span class="sidebar-info-label">Étage</span>
                        <span class="sidebar-info-value">{{ logement.get_etage_display }}</span>
                    </div>
                    {% if logement.note_moyenne > 0 %}
                    <div class="sidebar-info-item">
                        <span class="sidebar-info-label">Note</span>
                        <span class="sidebar-info-value">⭐ {{ logement.note_moyenne|floatformat:1 }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script>
        // Gallery
        const images = [
            {% for image in images %}
            {
                url: "{{ image.image.url }}",
                title: "{{ image.titre|default:logement.titre|escapejs }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];

        let currentImageIndex = 0;
        let currentLightboxIndex = 0;

        function changeGalleryImage(delta) {
            if (images.length === 0) return;
            currentImageIndex = (currentImageIndex + delta + images.length) % images.length;
            document.getElementById('gallery-main-img').src = images[currentImageIndex].url;
        }

        function openLightbox(index) {
            currentLightboxIndex = index;
            updateLightbox();
            document.getElementById('lightbox').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
            document.body.style.overflow = '';
        }

        function changeLightboxImage(delta) {
            if (images.length === 0) return;
            currentLightboxIndex = (currentLightboxIndex + delta + images.length) % images.length;
            updateLightbox();
        }

        function updateLightbox() {
            if (images.length === 0) return;
            document.getElementById('lightbox-image').src = images[currentLightboxIndex].url;
            document.getElementById('lightbox-counter').textContent = `${currentLightboxIndex + 1} / ${images.length}`;
        }

        // Lightbox keyboard navigation
        document.addEventListener('keydown', (e) => {
            const lightbox = document.getElementById('lightbox');
            if (lightbox.classList.contains('active')) {
                if (e.key === 'Escape') closeLightbox();
                if (e.key === 'ArrowLeft') changeLightboxImage(-1);
                if (e.key === 'ArrowRight') changeLightboxImage(1);
            }
        });

        // Click outside lightbox to close
        document.getElementById('lightbox').addEventListener('click', (e) => {
            if (e.target.id === 'lightbox') closeLightbox();
        });

        // Description toggle
        function toggleDescription() {
            const content = document.getElementById('description-content');
            const toggle = document.getElementById('description-toggle');
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggle.textContent = 'Afficher moins';
            } else {
                content.classList.add('collapsed');
                toggle.textContent = 'Afficher plus';
            }
        }

        // Map with custom marker
        const map = L.map('map').setView([{{ logement.latitude }}, {{ logement.longitude }}], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap',
            maxZoom: 19
        }).addTo(map);

        // Custom marker icon
        const customIcon = L.divIcon({
            className: 'custom-marker-icon',
            html: '<div class="custom-marker"></div>',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        const marker = L.marker([{{ logement.latitude }}, {{ logement.longitude }}], {
            icon: customIcon
        })
            .bindPopup(`
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 8px; min-width: 200px;">
                    <strong style="font-size: 16px; color: #222; display: block; margin-bottom: 4px;">{{ logement.titre|escapejs }}</strong>
                    <div style="font-size: 14px; color: #666;">{{ logement.adresse|escapejs }}</div>
                    <div style="font-size: 14px; color: #D3580B; font-weight: 600; margin-top: 8px;">{{ logement.prix }}€/mois</div>
                </div>
            `, {
                maxWidth: 250,
                className: 'custom-popup'
            })
            .addTo(map);

        function scrollToMap() {
            document.getElementById('map').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Navbar scroll effect
        const navbar = document.getElementById('navbar');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // Favorite toggle
        const favoriteBtn = document.getElementById('btn-favorite');
        if (favoriteBtn) {
            favoriteBtn.addEventListener('click', async () => {
                try {
                    const response = await fetch('{% url "api-toggle-favori" %}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({ logement_id: {{ logement.id }} })
                    });
                    
                    if (response.ok) {
                        location.reload();
                    }
                } catch (error) {
                    console.error('Error toggling favorite:', error);
                }
            });
        }

        // Share
        function shareProperty() {
            if (navigator.share) {
                navigator.share({
                    title: '{{ logement.titre|escapejs }}',
                    text: 'Découvrez ce logement sur Transpareo',
                    url: window.location.href
                }).catch(() => {});
            } else {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('Lien copié dans le presse-papiers !');
                });
            }
        }

        const shareButtons = document.querySelectorAll('[onclick="shareProperty()"]');
        shareButtons.forEach(btn => {
            if (btn) btn.addEventListener('click', shareProperty);
        });
        
        // Toggle Follow Owner (Phase 14.1)
        function toggleFollowOwner(ownerId) {
            const btn = document.getElementById('follow-owner-btn');
            if (!btn) return;
            
            fetch(`/connect/users/${ownerId}/follow/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    if (data.following) {
                        btn.textContent = '✓ Suivi';
                        btn.classList.add('btn-connect-following');
                    } else {
                        btn.textContent = '+ Suivre ce propriétaire';
                        btn.classList.remove('btn-connect-following');
                    }
                } else {
                    alert(data.error || 'Erreur lors de l\'action');
                }
            })
            .catch(err => {
                console.error('Error:', err);
                alert('Erreur lors de l\'action');
            });
        }

        // Dropdown interactions
        document.querySelectorAll('.dropbtn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const isExpanded = btn.getAttribute('aria-expanded') === 'true';
                document.querySelectorAll('.dropbtn').forEach(b => b.setAttribute('aria-expanded', 'false'));
                btn.setAttribute('aria-expanded', !isExpanded);
            });
        });

        document.addEventListener('click', () => {
            document.querySelectorAll('.dropbtn').forEach(btn => btn.setAttribute('aria-expanded', 'false'));
        });

        // User dropdown
        const userProfileBtn = document.querySelector('.user-profile-btn');
        if (userProfileBtn) {
            userProfileBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const isExpanded = userProfileBtn.getAttribute('aria-expanded') === 'true';
                userProfileBtn.setAttribute('aria-expanded', !isExpanded);
            });
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.user-profile-dropdown')) {
                if (userProfileBtn) userProfileBtn.setAttribute('aria-expanded', 'false');
            }
        });
    </script>
</body>
</html>